generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

//
// STUDENT
//
model Student {
  id              Int          @id @default(autoincrement())
  name            String
  email           String       @unique
  password        String
  branch          String
  year            Int
  gender          String
  preferredHostel String?
  createdAt       DateTime     @default(now())
  updatedAt       DateTime     @updatedAt

  allocations     Allocation[]
  complaints      Complaint[]
}

//
// HOSTEL
//
model Hostel {
  id             Int          @id @default(autoincrement())
  name           String
  genderAllowed  String
  capacity       Int
  createdAt      DateTime     @default(now())

  rooms          Room[]
  complaints     Complaint[]
  admins         Admin[]
}

//
// ROOM
//
model Room {
  id               Int          @id @default(autoincrement())
  hostelId         Int
  roomNumber       String
  capacity         Int
  occupiedCount    Int          @default(0)
  createdAt        DateTime     @default(now())

  hostel           Hostel       @relation(fields: [hostelId], references: [id])
  allocations      Allocation[]
  complaints       Complaint[]

  @@unique([hostelId, roomNumber])
}

//
// ALLOCATION
//
model Allocation {
  id         Int       @id @default(autoincrement())
  allocatedAt DateTime @default(now())
  studentId  Int
  roomId     Int
  active     Boolean   @default(true)

  student    Student   @relation(fields: [studentId], references: [id])
  room       Room      @relation(fields: [roomId], references: [id])

  @@index([roomId])
  @@index([studentId])
}

//
// COMPLAINT
//
model Complaint {
  id          Int       @id @default(autoincrement())
  issueType   String
  description String?
  severity    Severity
  status      Status    @default(PENDING)
  category    String?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  studentId   Int
  hostelId    Int
  roomId      Int?

  student     Student   @relation(fields: [studentId], references: [id])
  hostel      Hostel    @relation(fields: [hostelId], references: [id])
  room        Room?     @relation(fields: [roomId], references: [id])
}

//
// ADMIN
//
model Admin {
  id        Int        @id @default(autoincrement())
  name      String
  email     String     @unique
  password  String
  role      AdminRole  @default(HOSTEL_ADMIN)
  hostelId  Int?
  createdAt DateTime   @default(now())

  hostel    Hostel?    @relation(fields: [hostelId], references: [id])
}

//
// ENUMS
//
enum Severity {
  LOW
  MEDIUM
  HIGH
}

enum Status {
  PENDING
  IN_PROGRESS
  RESOLVED
  ESCALATED
  CLOSED
}

enum AdminRole {
  HOSTEL_ADMIN
}
